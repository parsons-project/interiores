/*
 */
package interiores.presentation.swing.views;

import interiores.core.presentation.SwingController;
import interiores.presentation.swing.views.editor.EditorTool;
import interiores.presentation.swing.views.editor.RoomMapPanel;
import interiores.presentation.swing.views.editor.WishListPanel;
import interiores.presentation.swing.views.editor.tools.MoveTool;
import interiores.presentation.swing.views.editor.tools.SelectionTool;
import java.awt.BorderLayout;
import java.util.HashMap;
import java.util.Map;
import javax.swing.JPanel;
import javax.swing.JToggleButton;

/**
 *
 * @author hector
 */
public class MapEditorPanel extends JPanel
{
    private RoomMapPanel mapPanel;
    private Map<JToggleButton, EditorTool> tools;
    private JToggleButton activeButton;
    
    /**
     * Creates new form MapEditorPanel
     */
    public MapEditorPanel(SwingController swing)
    {
        initComponents();
        
        mapPanel = swing.getNew(RoomMapPanel.class);
        WishListPanel wishListPanel = swing.getNew(WishListPanel.class);
        
        add(mapPanel, BorderLayout.CENTER);
        add(wishListPanel, BorderLayout.LINE_END);
        
        mapPanel.setVisible(true);
        wishListPanel.setVisible(true);
        
        tools = new HashMap();
        addTools(swing);
        setActiveButton(selectionButton);  
    }
    
    private void addTools(SwingController swing) {
        tools.put(selectionButton, new SelectionTool(swing));
        tools.put(moveButton, new MoveTool());
    }
    
    private void setActiveTool(Object o) {
        JToggleButton button = (JToggleButton) o;
        
        // When a button is selected, its model changes automatically
        // so !isSelected means that the button WAS selected
        if(!tools.containsKey(button) || !button.isSelected()) {
            button.setSelected(true); // Reselect
            return;
        }
        
        if(activeButton != null)
            activeButton.setSelected(false);
        
        setActiveButton(button);
    }
    
    private void setActiveButton(JToggleButton button) {
        activeButton = button;
        activeButton.setSelected(true);
        mapPanel.setActiveTool(tools.get(activeButton));
    }
    
    /**
     * This method is called from within the constructor to initialize the form. WARNING: Do NOT modify this
     * code. The content of this method is always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents()
    {

        jToolBar1 = new javax.swing.JToolBar();
        selectionButton = new javax.swing.JToggleButton();
        moveButton = new javax.swing.JToggleButton();
        doorButton = new javax.swing.JToggleButton();
        windowButton = new javax.swing.JToggleButton();
        pillarButton = new javax.swing.JToggleButton();

        setLayout(new java.awt.BorderLayout());

        jToolBar1.setFloatable(false);
        jToolBar1.setOrientation(1);
        jToolBar1.setRollover(true);

        selectionButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/cursor.png"))); // NOI18N
        selectionButton.setToolTipText("Selection tool");
        selectionButton.setFocusable(false);
        selectionButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        selectionButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        selectionButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                selectionButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(selectionButton);

        moveButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/move.png"))); // NOI18N
        moveButton.setToolTipText("Move tool");
        moveButton.setFocusable(false);
        moveButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        moveButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        moveButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                moveButtonActionPerformed(evt);
            }
        });
        jToolBar1.add(moveButton);

        doorButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/door.png"))); // NOI18N
        doorButton.setToolTipText("Door tool");
        doorButton.setFocusable(false);
        doorButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        doorButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToolBar1.add(doorButton);

        windowButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/window.png"))); // NOI18N
        windowButton.setToolTipText("Windows tool");
        windowButton.setFocusable(false);
        windowButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        windowButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToolBar1.add(windowButton);

        pillarButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/cube.png"))); // NOI18N
        pillarButton.setToolTipText("Pillar tool");
        pillarButton.setFocusable(false);
        pillarButton.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        pillarButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jToolBar1.add(pillarButton);

        add(jToolBar1, java.awt.BorderLayout.LINE_START);
    }// </editor-fold>//GEN-END:initComponents

    private void moveButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_moveButtonActionPerformed
    {//GEN-HEADEREND:event_moveButtonActionPerformed
        setActiveTool(evt.getSource());
    }//GEN-LAST:event_moveButtonActionPerformed

    private void selectionButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_selectionButtonActionPerformed
    {//GEN-HEADEREND:event_selectionButtonActionPerformed
        setActiveTool(evt.getSource());
    }//GEN-LAST:event_selectionButtonActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JToggleButton doorButton;
    private javax.swing.JToolBar jToolBar1;
    private javax.swing.JToggleButton moveButton;
    private javax.swing.JToggleButton pillarButton;
    private javax.swing.JToggleButton selectionButton;
    private javax.swing.JToggleButton windowButton;
    // End of variables declaration//GEN-END:variables
}
